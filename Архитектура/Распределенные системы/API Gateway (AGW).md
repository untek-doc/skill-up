**API Gateway (шлюз API)** — это сервер или инструмент, который управляет запросами к микросервисам от клиентов. Он служит единой точкой входа в распределённую систему, предоставляя функции маршрутизации запросов, балансировки нагрузки, аутентификации, авторизации, мониторинга, обработки ошибок и трансформации данных.

API Gateway часто используется в архитектуре микросервисов, чтобы скрыть сложность внутренних систем от клиента, предоставляя упрощённый и единообразный интерфейс.

---

### **Функции API Gateway**

1. **Маршрутизация запросов**:
    
    - API Gateway направляет запросы от клиентов к соответствующим микросервисам на основе URL или других параметров.
2. **Аутентификация и авторизация**:
    
    - Проверяет права доступа клиентов с помощью токенов, OAuth, API-ключей или других методов.
3. **Балансировка нагрузки**:
    
    - Распределяет запросы между несколькими экземплярами микросервисов для повышения производительности и надёжности.
4. **Трансформация данных**:
    
    - Конвертирует запросы и ответы между различными форматами (например, JSON в XML).
5. **Кэширование**:
    
    - Сохраняет результаты запросов для снижения нагрузки на микросервисы.
6. **Сбор метрик и мониторинг**:
    
    - Генерирует логи и метрики для анализа производительности и отслеживания ошибок.
7. **Обработка ошибок**:
    
    - Упрощает работу клиентов, предоставляя централизованную обработку ошибок.
8. **Поддержка версий API**:
    
    - Позволяет управлять несколькими версиями API одновременно.
9. **Поддержка ограничений нагрузки (Rate Limiting)**:
    
    - Контролирует количество запросов от клиента для защиты от перегрузки или злоупотреблений.

---

### **Зачем нужен API Gateway?**

API Gateway решает множество проблем, возникающих при использовании микросервисной архитектуры:

- Упрощает взаимодействие клиентов с системой, скрывая сложность микросервисов.
- Централизует управление безопасностью.
- Повышает производительность за счёт кэширования и балансировки нагрузки.
- Позволяет клиентам взаимодействовать с системой через единый интерфейс, независимо от изменений во внутренней архитектуре.

---

### **Примеры использования API Gateway**

#### 1. **Единая точка входа**

Клиенты (например, веб-приложения, мобильные приложения) взаимодействуют с системой через API Gateway, который перенаправляет запросы к нужным микросервисам:

- `/user` → перенаправляется в сервис авторизации.
- `/orders` → перенаправляется в сервис заказов.

#### 2. **Разные клиенты — разные запросы**

API Gateway может обрабатывать запросы от различных типов клиентов (например, веб, мобильные приложения, IoT-устройства) и преобразовывать их в нужный формат для микросервисов.

#### 3. **Кэширование**

Часто используемые данные, такие как конфигурации или статистика, могут кэшироваться на уровне API Gateway, чтобы уменьшить нагрузку на микросервисы.

---

### **Популярные реализации API Gateway**

1. **AWS API Gateway**:
    
    - Облачный шлюз API, интегрированный с другими сервисами AWS.
    - Поддерживает REST и WebSocket API.
2. **Kong**:
    
    - Открытый исходный код.
    - Предоставляет плагины для безопасности, мониторинга и трансформации данных.
3. **Apigee**:
    
    - Корпоративное решение от Google.
    - Поддерживает продвинутые функции управления API.
4. **Istio Gateway**:
    
    - Интегрируется с Service Mesh (например, Istio) для управления микросервисами и API.
5. **NGINX**:
    
    - Высокопроизводительный веб-сервер, часто используемый как API Gateway.
6. **Spring Cloud Gateway**:
    
    - Решение для Java-приложений в экосистеме Spring.

---

### **Преимущества использования API Gateway**

1. **Скрытие сложности системы**:
    
    - Клиенты взаимодействуют с одной точкой входа вместо множества микросервисов.
2. **Улучшенная безопасность**:
    
    - Централизованное управление аутентификацией, авторизацией и шифрованием.
3. **Производительность**:
    
    - Балансировка нагрузки, кэширование и оптимизация запросов.
4. **Гибкость**:
    
    - Лёгкое управление версиями API и преобразование данных.
5. **Наблюдаемость**:
    
    - Сбор метрик, логов и мониторинг системы через одну точку.

---

### **Недостатки использования API Gateway**

1. **Единая точка отказа**:
    
    - Если API Gateway выходит из строя, клиенты теряют доступ к системе. (Решается кластеризацией и резервированием).
2. **Сложность настройки**:
    
    - Настройка и управление API Gateway могут быть сложными, особенно в крупных системах.
3. **Задержки**:
    
    - Добавляет дополнительный слой, что может увеличивать время отклика.

---

### **API Gateway vs. Service Mesh**

|**Характеристика**|**API Gateway**|**Service Mesh**|
|---|---|---|
|**Фокус**|Управление входящими запросами (клиент → API)|Управление внутренними взаимодействиями (сервис → сервис)|
|**Функции**|Аутентификация, маршрутизация, кэширование|Надёжность, безопасность, балансировка нагрузки|
|**Пример использования**|Входная точка для клиентских приложений|Контроль трафика между микросервисами|
|**Интеграция**|Внешние клиенты (мобильные, веб-приложения)|Внутренние взаимодействия между сервисами|

---

### **Пример работы API Gateway**

#### Клиенты:

- Мобильное приложение.
- Веб-приложение.

#### Внутренние микросервисы:

- **Auth Service**: Аутентификация.
- **Order Service**: Управление заказами.
- **Product Service**: Управление продуктами.

#### Работа API Gateway:

1. Клиент отправляет запрос на `/login` → API Gateway перенаправляет запрос в **Auth Service**.
2. После успешного входа клиент отправляет запрос на `/orders` → API Gateway перенаправляет запрос в **Order Service**.
3. API Gateway добавляет токен в запрос, кэширует данные и собирает метрики для мониторинга.

---

### **Заключение**

API Gateway — это ключевой компонент в архитектуре микросервисов, который упрощает взаимодействие клиентов с системой, улучшает безопасность и наблюдаемость. Он помогает централизовать управление API, избавляя клиентов от необходимости разбираться в сложностях внутренней архитектуры.