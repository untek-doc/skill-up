**Onion Architecture** (Луковичная архитектура) — это архитектурный стиль, который помогает разделять ответственность между уровнями приложения и минимизировать связанность. В этом подходе основное внимание уделяется изоляции **доменной модели** от инфраструктуры и внешних слоёв.

В контексте направления **потока управления** Onion Architecture предполагает, что управление данными и бизнес-логикой движется **от внешних слоёв к центральным** (ядру), а зависимости направлены **вглубь** архитектуры, к доменному уровню.

---

### **Структура слоёв и направление потока управления**

1. **Core/Domain Layer (Центральное ядро):**
    
    - Это самая внутренняя часть "луковицы".
    - Содержит:
        - Доменные сущности (Entities).
        - Логика предметной области (Value Objects, Aggregates).
        - Интерфейсы (например, репозитории, которые реализуются внешними слоями).
    - **Поток управления:** вся логика приложения направляется к этому ядру.
2. **Application Layer (Слой приложения):**
    
    - Реализует кейсы использования (Use Cases).
    - Организует взаимодействие между внешними слоями и доменной моделью.
    - **Поток управления:** принимает запросы от интерфейсов (UI, API) и вызывает доменные сервисы/объекты.
3. **Infrastructure Layer (Инфраструктура):**
    
    - Реализует зависимости, такие как базы данных, сетевые взаимодействия, внешние API, файловые хранилища.
    - Содержит:
        - Реализацию репозиториев.
        - Интеграции с внешними сервисами.
    - **Поток управления:** отвечает за детали, например, извлечение данных из хранилищ или отправку данных в домен.
4. **UI/Presentation Layer (Интерфейс пользователя):**
    
    - Содержит интерфейсы пользователя (например, веб-контроллеры, API-эндпоинты).
    - Предназначен для отображения данных и получения пользовательских запросов.
    - **Поток управления:** передаёт пользовательский ввод в слой приложения для обработки.

---

### **Направление зависимостей**

- **Внешние слои зависят от внутренних**, но не наоборот.
- Пример:
    - UI вызывает Application Layer.
    - Application Layer взаимодействует с Domain Layer.
    - Infrastructure Layer реализует интерфейсы, определённые в Domain Layer, но сам не содержит логики предметной области.

---

### **Поток управления на практике**

1. **Инициирование**:
    
    - Пользователь инициирует действие через UI (например, отправляет HTTP-запрос).
2. **Передача данных**:
    
    - UI слой передаёт запрос в Application Layer.
3. **Вызов доменной логики**:
    
    - Application Layer вызывает доменные сервисы и объекты, обрабатывает запрос, следуя логике предметной области.
4. **Работа с инфраструктурой**:
    
    - Если требуется, Application Layer вызывает репозитории или внешние интеграции, чтобы получить или сохранить данные.
5. **Ответ пользователю**:
    
    - Обработанный результат передаётся через UI слой пользователю.

---

### **Пример: Создание заказа в системе электронной коммерции**

1. Пользователь отправляет запрос через веб-интерфейс (UI Layer).
2. Application Layer обрабатывает запрос, создаёт заказ, проверяет бизнес-правила и вызывает доменные объекты.
3. Domain Layer содержит логику создания заказа, его валидацию и управление состоянием.
4. Application Layer обращается к Infrastructure Layer, чтобы сохранить данные в базе.
5. Результат возвращается пользователю через UI Layer.
