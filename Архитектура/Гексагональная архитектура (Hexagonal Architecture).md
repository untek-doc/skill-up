Гексагональная архитектура (Hexagonal Architecture), также известная как **портов и адаптеров (Ports and Adapters)**, — это архитектурный паттерн, который помогает создавать приложения, независимые от внешних инфраструктурных деталей, таких как базы данных, пользовательские интерфейсы или API. Главная идея — изолировать доменную логику от инфраструктуры, обеспечивая гибкость и удобство тестирования.

---

### Основные концепции

1. **Центральная часть: Домен**  
   - В центре архитектуры находится **доменная логика** — это "сердце" приложения.  
   - Домен полностью изолирован от внешнего мира и ничего не знает о том, как и через что он взаимодействует с внешними системами.

2. **Порты (Ports)**  
   - Это интерфейсы, определяющие способы взаимодействия между доменом и внешним миром.
   - **Входные порты (Inbound Ports)** — интерфейсы, через которые внешние системы (например, веб-приложения) вызывают доменные операции.
   - **Выходные порты (Outbound Ports)** — интерфейсы, которые домен использует для взаимодействия с внешними системами (например, базы данных, API).

3. **Адаптеры (Adapters)**  
   - Реализации портов, которые связывают домен с конкретными технологиями или инфраструктурой.
   - **Входные адаптеры (Inbound Adapters)** — принимают запросы от внешних систем и передают их в домен. Например, HTTP-контроллеры, слушатели событий.
   - **Выходные адаптеры (Outbound Adapters)** — реализуют взаимодействие с внешними системами. Например, репозитории, реализации работы с REST API.

4. **Инфраструктура (Infrastructure)**  
   - Это внешний уровень архитектуры, который включает в себя базы данных, API, фреймворки, и другие инструменты.

---

### Преимущества гексагональной архитектуры

1. **Слабая связанность**  
   Доменная логика изолирована от инфраструктуры, что делает код более модульным и легко тестируемым.

2. **Тестируемость**  
   Благодаря четким границам между слоями, легко заменять адаптеры на заглушки (mock) для тестирования доменной логики.

3. **Гибкость**  
   Инфраструктурные детали можно легко заменить или модернизировать (например, заменить SQL-базу данных на NoSQL) без изменения доменной логики.

4. **Устойчивость к изменениям**  
   Изменения в одном из адаптеров минимально влияют на остальные части приложения.

---

### Пример структуры гексагонального приложения

1. **Доменная логика**  
   - Сущности (Entities)  
   - Сервисы (Domain Services)  
   - Входные и выходные интерфейсы (Ports)

2. **Входные адаптеры**  
   - HTTP-контроллеры  
   - CLI-команды  
   - Слушатели событий  

3. **Выходные адаптеры**  
   - Реализации репозиториев (например, работа с базой данных)  
   - Взаимодействие с внешними API  

---

### Пример на PHP

```php
// Доменный интерфейс (Порт)
interface UserRepository {
    public function findById(int $id): User;
}

// Доменный сервис
class UserService {
    private UserRepository $userRepository;

    public function __construct(UserRepository $userRepository) {
        $this->userRepository = $userRepository;
    }

    public function getUserProfile(int $id): User {
        return $this->userRepository->findById($id);
    }
}

// Адаптер для базы данных
class MySQLUserRepository implements UserRepository {
    public function findById(int $id): User {
        // Реализация работы с базой данных
    }
}

// Входной адаптер (например, контроллер)
class UserController {
    private UserService $userService;

    public function __construct(UserService $userService) {
        $this->userService = $userService;
    }

    public function getUserProfile(int $id): User {
        return $this->userService->getUserProfile($id);
    }
}
```

---

### Когда использовать гексагональную архитектуру

1. Если ваше приложение предполагает сложную бизнес-логику, которую нужно изолировать от инфраструктуры.  
2. Если требуется легкость в тестировании.  
3. Если ожидаются частые изменения в инфраструктуре (например, смена базы данных).  
4. Если проект рассчитан на долгосрочную поддержку и развитие.

Гексагональная архитектура — мощный инструмент, который помогает создать гибкое и устойчивое приложение. Однако для небольших проектов её избыточность может привести к увеличению сложности разработки.