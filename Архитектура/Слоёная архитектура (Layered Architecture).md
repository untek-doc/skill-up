Слоёная архитектура (Layered Architecture), также известная как многослойная архитектура (N-tier Architecture), — это один из самых популярных и широко используемых подходов к проектированию приложений. Она предполагает разделение приложения на логические слои, каждый из которых отвечает за свою часть функциональности.

---

### Основные слои

1. **Presentation Layer (Слой представления)**  
   - Отвечает за взаимодействие с пользователем.
   - Основная задача — отображение данных и получение ввода от пользователя.
   - Примеры: веб-интерфейс, мобильное приложение, API.  
   - Обычно включает контроллеры (например, MVC-контроллеры в Laravel или Spring).

2. **Application Layer (Слой приложения)**  
   - Обеспечивает связь между слоем представления и бизнес-логикой.
   - Содержит сценарии использования (Use Cases), которые определяют последовательность выполнения операций.
   - Этот слой также может управлять транзакциями.  
   - Иногда объединяется с доменным слоем в небольших приложениях.

3. **Domain Layer (Слой домена / Бизнес-логики)**  
   - Сердце приложения, где находится вся бизнес-логика.
   - Включает сущности (Entities), доменные сервисы и бизнес-правила.
   - Этот слой не должен зависеть от других слоёв (например, базы данных или пользовательского интерфейса).

4. **Data Access Layer (Слой доступа к данным)**  
   - Отвечает за взаимодействие с хранилищами данных (базы данных, файловые системы, внешние API).  
   - Обычно содержит репозитории, мапперы и объекты для работы с конкретными технологиями хранения.

---

### Принципы взаимодействия между слоями

- Слои должны взаимодействовать строго в одном направлении: верхние слои зависят от нижних.
  Пример: Слой представления может вызывать методы слоя приложения, но не наоборот.
  
- Слои не должны знать о деталях реализации других слоёв. Они взаимодействуют через интерфейсы или абстракции.

---

### Пример на PHP

#### 1. **Слой домена (Domain Layer)**

```php
class Order {
    private int $id;
    private float $total;

    public function __construct(int $id, float $total) {
        $this->id = $id;
        $this->total = $total;
    }

    public function getId(): int {
        return $this->id;
    }

    public function getTotal(): float {
        return $this->total;
    }

    public function applyDiscount(float $percent): void {
        $this->total -= $this->total * ($percent / 100);
    }
}
```

#### 2. **Слой приложения (Application Layer)**

```php
class OrderService {
    private OrderRepository $orderRepository;

    public function __construct(OrderRepository $orderRepository) {
        $this->orderRepository = $orderRepository;
    }

    public function applyDiscountToOrder(int $orderId, float $discountPercent): void {
        $order = $this->orderRepository->findById($orderId);
        $order->applyDiscount($discountPercent);
        $this->orderRepository->save($order);
    }
}
```

#### 3. **Слой доступа к данным (Data Access Layer)**

```php
class OrderRepository {
    public function findById(int $id): Order {
        // Логика загрузки заказа из базы данных
        return new Order($id, 100.0); // Заглушка
    }

    public function save(Order $order): void {
        // Логика сохранения заказа в базу данных
    }
}
```

#### 4. **Слой представления (Presentation Layer)**

```php
class OrderController {
    private OrderService $orderService;

    public function __construct(OrderService $orderService) {
        $this->orderService = $orderService;
    }

    public function applyDiscount(int $orderId, float $discountPercent): void {
        $this->orderService->applyDiscountToOrder($orderId, $discountPercent);
        echo "Скидка применена!";
    }
}
```

---

### Преимущества слоёной архитектуры

1. **Простота понимания**  
   Логика приложения разделена на четкие слои, что упрощает работу с кодом.

2. **Упрощенное тестирование**  
   Каждый слой можно тестировать независимо, используя заглушки и моки для других слоев.

3. **Легкость масштабирования**  
   Можно заменить или оптимизировать один слой (например, слой данных) без изменения других слоёв.

4. **Повторное использование**  
   Код из одного слоя может быть использован в разных контекстах. Например, бизнес-логика может быть вызвана из веб-интерфейса и из консольного приложения.

---

### Недостатки

1. **Жесткая связанность**  
   Верхние слои зависят от нижних, что затрудняет замену технологий (например, смену базы данных).

2. **Могут быть нарушены границы слоёв**  
   Разработчики могут начать обходить слои, например, из контроллера напрямую обращаться к базе данных.

3. **Избыточность для небольших приложений**  
   В небольших проектах использование всех слоев может привести к усложнению кода.

---

### Когда использовать?

Слоёная архитектура подходит для большинства приложений с относительно простой структурой. Однако в более сложных проектах с высокими требованиями к гибкости и тестируемости можно рассмотреть альтернативы, такие как **гексагональная архитектура** или **архитектура с использованием CQRS и Event Sourcing**.