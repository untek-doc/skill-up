**MAC (Message Authentication Code)** и **HMAC (Hash-Based Message Authentication Code)** — это методы криптографической аутентификации сообщений, которые позволяют удостовериться в их подлинности и целостности. Эти механизмы особенно полезны при передаче данных через ненадёжные каналы связи, поскольку помогают убедиться, что сообщение не было изменено и что оно действительно пришло от подлинного отправителя.

### Что такое MAC?

**MAC (Message Authentication Code)** — это код аутентификации сообщения, который вычисляется с использованием криптографического ключа. Он выполняет две основные функции:
1. **Проверка подлинности**: Удостоверяет, что сообщение было отправлено авторизованным отправителем.
2. **Целостность сообщения**: Подтверждает, что сообщение не изменялось во время передачи.

#### Как работает MAC?
1. Генерация MAC происходит с использованием симметричного криптографического алгоритма (например, AES, DES) и секретного ключа.
2. Отправитель использует этот алгоритм и ключ для создания кода MAC, который затем передаётся вместе с сообщением.
3. Получатель, обладая тем же ключом, повторяет процесс создания MAC и сравнивает его с полученным кодом. Если коды совпадают, то считается, что сообщение не изменено и отправлено подлинным отправителем.

### Что такое HMAC?

**HMAC (Hash-Based Message Authentication Code)** — это разновидность MAC, которая использует хэш-функцию (например, SHA-256 или MD5) вместе с секретным ключом для вычисления кода аутентификации. В отличие от классического MAC, который полагается на симметричные криптографические алгоритмы, HMAC применяет хэширование и обеспечивает высокую безопасность.

#### Как работает HMAC?
1. Для создания HMAC берётся секретный ключ и сообщение.
2. Применяется хэш-функция, которая объединяет ключ и сообщение с использованием специального алгоритма, делающего вычисления надёжнее и устойчивее к атаке.
3. Полученный код HMAC передаётся вместе с сообщением, и получатель с помощью того же ключа может проверить целостность сообщения.

#### Формула HMAC
Основное уравнение для вычисления HMAC:
\[
\text{HMAC}(key, message) = \text{hash}((key \oplus opad) \parallel \text{hash}((key \oplus ipad) \parallel message))
\]
где:
- **hash** — выбранная хэш-функция (например, SHA-256),
- **opad** и **ipad** — специальные значения (outer pad и inner pad), которые дополняют ключ и усиливают защиту,
- **\(\parallel\)** — конкатенация (соединение) данных.

### Преимущества HMAC перед MAC

- **Устойчивость к коллизиям**: Хэш-функции, особенно безопасные, как SHA-256, затрудняют подбор разных сообщений с одинаковым значением HMAC.
- **Гибкость**: HMAC может использовать разные хэш-функции, что позволяет настраивать алгоритм под различные требования к безопасности.
- **Широкое применение**: HMAC используется в сетевых протоколах (например, HTTPS, IPsec) и API для безопасной передачи данных и проверки подлинности.

### Примеры использования MAC и HMAC

1. **Сетевые протоколы**: HMAC часто используется в протоколах аутентификации и шифрования, например, в HTTPS, TLS и IPsec.
2. **API и веб-приложения**: HMAC применяется для защиты и проверки целостности API-запросов. 
3. **Защита токенов доступа**: В REST API, HMAC используется для создания токенов доступа, которые могут подтвердить подлинность клиента.

### Сравнение MAC и HMAC

| Характеристика                | MAC                                | HMAC                               |
|-------------------------------|------------------------------------|------------------------------------|
| **Метод вычисления**          | Симметричные алгоритмы (AES, DES)  | Хэш-функции (SHA-256, MD5)         |
| **Секретный ключ**            | Требуется                          | Требуется                          |
| **Устойчивость к атакам**     | Зависит от алгоритма               | Высокая (устойчив к атакам на коллизии) |
| **Применение**                | Ограничено                         | Широко используется в интернете и API |
| **Производительность**        | Высокая для небольших сообщений    | Высокая для хэш-функций            |

Таким образом, HMAC — это надёжный способ аутентификации сообщений, который является универсальным и устойчивым к множеству атак, в то время как MAC также обеспечивает безопасность, но чаще применяется в более контролируемых системах с использованием симметричного шифрования.