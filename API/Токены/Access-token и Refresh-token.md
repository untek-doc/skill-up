**Access-token** и **Refresh-token** — это токены, которые используются в системах аутентификации и авторизации для безопасного доступа к ресурсам, особенно при работе с API. Оба токена играют ключевую роль в современных механизмах авторизации, таких как **OAuth 2.0**.

### 1. **Access-token**

**Access-token** — это короткоживущий токен, который представляет собой разрешение на доступ к защищенным ресурсам от имени пользователя. Он передается вместе с запросами к API для аутентификации пользователя или приложения.

#### Характеристики Access-token:
- **Кратковременный срок действия**: Обычно срок действия Access-токена ограничен (например, несколько минут или часов), чтобы минимизировать риск использования токена в случае его утечки.
- **Использование**: Access-token передается в заголовке HTTP-запроса в поле `Authorization` для доступа к защищенным ресурсам.
  
  Пример использования Access-token в запросе:
```http
GET /user/profile HTTP/1.1
Host: api.example.com
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

- **Формат**: Чаще всего Access-token используется в формате JWT (JSON Web Token), хотя могут использоваться и другие форматы.
- **Содержимое**: Токен может содержать информацию о пользователе (например, идентификатор пользователя) и разрешениях (например, доступ к определенным ресурсам).

#### Проблема:
- **Краткосрочный доступ**: Когда Access-token истекает, пользователь больше не может получать доступ к ресурсам, и необходимо снова аутентифицироваться. Однако для этого используется Refresh-token.

### 2. **Refresh-token**

**Refresh-token** — это долгоживущий токен, который используется для обновления Access-token, когда последний истекает. Refresh-токен не отправляется с каждым запросом к API, а используется для получения нового Access-token через специальный эндпоинт (обычно `token/refresh`).

#### Характеристики Refresh-token:
- **Долгосрочный срок действия**: Refresh-token действует дольше, чем Access-token, часто на дни, недели или даже месяцы. Это позволяет пользователям оставаться аутентифицированными, не вводя заново свои учетные данные.
- **Использование**: Когда Access-token истекает, клиент отправляет запрос на сервер с Refresh-token для получения нового Access-token.
  
  Пример запроса для обновления Access-token:
```http
POST /auth/refresh HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
"refresh_token": "dGhpcyBpcyBhIHNhbXBsZSByZWZyZXNoIHRva2Vu"
}
```

- **Безопасность**: Refresh-token хранится на клиенте, обычно в более защищенном месте (например, в HTTP-only cookie или безопасном хранилище), так как его утечка может дать злоумышленнику возможность продлить доступ без повторной аутентификации.
- **Использование с сервером**: Refresh-token используется только для обмена на новый Access-token и не передается в каждом запросе к API.

#### Проблема:
- **Уязвимость при краже**: Если злоумышленник получает Refresh-token, он может использовать его для получения новых Access-token без участия пользователя. Поэтому безопасность хранения Refresh-token очень важна.

### Как работают Access-token и Refresh-token вместе?

1. **Аутентификация пользователя**:
   - Пользователь вводит свои учетные данные (логин и пароль) в систему, которая проверяет их.
   - После успешной аутентификации сервер возвращает клиенту два токена: Access-token и Refresh-token.

2. **Доступ к API с использованием Access-token**:
   - Клиент использует Access-token для доступа к защищенным ресурсам API. Этот токен передается в заголовке `Authorization` каждого запроса.

3. **Истечение Access-token**:
   - После того как Access-token истекает (например, через час), клиент больше не может использовать его для доступа к API.

4. **Использование Refresh-token для получения нового Access-token**:
   - Клиент отправляет запрос на сервер с Refresh-token для получения нового Access-token. Сервер проверяет Refresh-token и возвращает новый Access-token.

5. **Обновление Access-token и продолжение работы**:
   - Клиент получает новый Access-token и использует его для дальнейших запросов к API.

6. **Истечение Refresh-token**:
   - Когда Refresh-token также истекает (например, через неделю), пользователю необходимо повторно аутентифицироваться (например, ввести логин и пароль).

### Пример взаимодействия с токенами

1. Пользователь аутентифицируется и получает два токена:
   ```json
   {
     "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
     "refresh_token": "dGhpcyBpcyBhIHNhbXBsZSByZWZyZXNoIHRva2Vu"
   }
   ```

2. Клиент отправляет запросы к API с Access-token:
```http
GET /user/profile HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

3. Когда Access-token истекает, клиент отправляет Refresh-token для получения нового:
```http
POST /auth/refresh HTTP/1.1
Content-Type: application/json

{
 "refresh_token": "dGhpcyBpcyBhIHNhbXBsZSByZWZyZXNoIHRva2Vu"
}
```

4. Сервер возвращает новый Access-token:
```json
{
 "access_token": "new_access_token_eyJhbGciOiJIUzI1NiIs..."
}
   ```

### Безопасность Access-token и Refresh-token

- **Access-token**: Из-за короткого срока действия Access-token более безопасен в случае утечки, так как его можно быстро аннулировать. Его рекомендуется хранить в памяти или в безопасных cookie с флагом `HttpOnly`.
  
- **Refresh-token**: Refresh-token обычно действует дольше, поэтому его безопасность критична. Его стоит хранить в защищенных местах, таких как `HttpOnly` cookie или безопасные контейнеры на клиенте.

### Заключение

**Access-token** используется для краткосрочного доступа к защищенным ресурсам, а **Refresh-token** — для получения нового Access-token, когда первый истечет. Такой подход позволяет улучшить безопасность и удобство работы с авторизацией в системах с долгосрочными сессиями, минимизируя необходимость повторной аутентификации пользователя.