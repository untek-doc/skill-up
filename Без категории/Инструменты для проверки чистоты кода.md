Проверка чистоты кода важна для поддержания его качества, удобства сопровождения и соответствия стандартам. Для этого используются различные инструменты статического и динамического анализа кода. Вот основные инструменты, которые помогают проверить чистоту кода, особенно в проектах на PHP.

---

## **Инструменты для проверки чистоты кода**

### **1. Статический анализ кода**

Эти инструменты анализируют код без его выполнения, выявляя потенциальные ошибки, нарушение стандартов, проблемы безопасности и стиль.

#### **PHPStan**

- **Описание:** Анализатор кода для PHP, который проверяет типы, ошибки и потенциальные баги без выполнения кода.
- **Преимущества:**
    - Проверяет типы переменных, возвращаемых значений и аргументов.
    - Интеграция с популярными фреймворками и библиотеками.
    - Поддержка пользовательских правил.
- **Установка:**
    
    ```bash
    composer require --dev phpstan/phpstan
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/phpstan analyse src --level=5
    ```
    

#### **Psalm**

- **Описание:** Мощный статический анализатор кода от Facebook, специализирующийся на проверке типов и ошибок.
- **Преимущества:**
    - Глубокий анализ типов.
    - Поддержка аннотаций `@psalm-*` для повышения детализации.
    - Автоматические исправления проблем.
- **Установка:**
    
    ```bash
    composer require --dev vimeo/psalm
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/psalm
    ```
    

#### **Phan**

- **Описание:** Инструмент для анализа типов и ошибок в PHP-коде.
- **Преимущества:**
    - Обнаруживает неиспользуемые переменные, несуществующие методы и ошибки типов.
    - Поддерживает PHP 7+.
- **Установка:**
    
    ```bash
    composer require --dev phan/phan
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/phan
    ```
    

---

### **2. Линтеры**

Линтеры проверяют соответствие кода установленным стандартам стиля.

#### **PHP_CodeSniffer**

- **Описание:** Инструмент для проверки соответствия кода стандартам PSR (PSR-1, PSR-2, PSR-12).
- **Преимущества:**
    - Настраиваемые правила.
    - Автоматическое исправление некоторых ошибок.
- **Установка:**
    
    ```bash
    composer require --dev squizlabs/php_codesniffer
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/phpcs --standard=PSR12 src/
    ```
    
- **Автофикс:**
    
    ```bash
    vendor/bin/phpcbf --standard=PSR12 src/
    ```
    

#### **PHP-CS-Fixer**

- **Описание:** Инструмент для автоматического исправления стиля кода в соответствии с PSR и другими стандартами.
- **Преимущества:**
    - Много предустановленных правил.
    - Простота настройки.
- **Установка:**
    
    ```bash
    composer require --dev friendsofphp/php-cs-fixer
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/php-cs-fixer fix src/
    ```
    

---

### **3. Проверка качества и безопасности**

Инструменты для анализа кода на предмет безопасности и тестирования метрик качества.

#### **SonarQube**

- **Описание:** Платформа для анализа кода на более чем 25 языках, включая PHP.
- **Преимущества:**
    - Отчеты о проблемах безопасности, дублировании кода и сложности.
    - Метрики для оценки качества кода.
    - Интеграция с CI/CD.
- **Использование:** Установка сервера SonarQube и подключение с помощью клиента (например, **SonarScanner**).

#### **RIPS (или его аналоги)**

- **Описание:** Инструмент для анализа кода PHP на наличие уязвимостей.
- **Преимущества:**
    - Обнаруживает SQL-инъекции, XSS, проблемы с безопасностью файлов и другие.
    - Специализирован для безопасности PHP.

#### **PHP Metrics**

- **Описание:** Инструмент для анализа метрик качества кода.
- **Преимущества:**
    - Метрики сложности, производительности, сопровождения.
    - Генерация визуальных отчетов.
- **Установка:**
    
    ```bash
    composer require --dev phpmetrics/phpmetrics
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/phpmetrics --report-html=report.html src/
    ```
    

---

### **4. Комплексные инструменты**

#### **Laravel Pint**

- **Описание:** Удобный инструмент для автоформатирования кода в проектах Laravel.
- **Преимущества:**
    - Простота настройки для Laravel.
    - Работает "из коробки" с настройками PSR.
- **Установка:**
    
    ```bash
    composer require laravel/pint --dev
    ```
    
- **Пример запуска:**
    
    ```bash
    vendor/bin/pint
    ```
    

#### **GrumPHP**

- **Описание:** Инструмент, который проверяет код на этапе коммита в Git.
- **Преимущества:**
    - Автоматизация проверок перед внесением изменений.
    - Интеграция с PHPStan, PHP-CS-Fixer и другими.
- **Установка:**
    
    ```bash
    composer require --dev phpro/grumphp
    ```
    
- **Пример настройки:** Добавление конфигурации в файл `grumphp.yml`.

---

### **5. CI/CD-интеграция**

Инструменты можно настроить для автоматического запуска в CI/CD-пайплайнах:

- **GitHub Actions**: Поддерживает запуск PHPStan, PHP_CodeSniffer и других.
- **GitLab CI/CD**: Автоматизация проверок на этапе сборки.
- **Jenkins/Travis CI**: Настройка проверок качества и статического анализа.

---

### **Рекомендации по выбору:**

1. **Для статического анализа:** PHPStan или Psalm.
2. **Для проверки стиля:** PHP_CodeSniffer или PHP-CS-Fixer.
3. **Для метрик и анализа безопасности:** SonarQube или PHP Metrics.
4. **Для командной работы:** GrumPHP или интеграция с CI/CD.

Эти инструменты можно комбинировать, чтобы покрыть все аспекты чистоты и качества кода.