**Имутабельность (Immutability)** — это свойство объекта, означающее, что его состояние не может быть изменено после создания. Если требуется изменить объект, создаётся его новая версия с обновлёнными значениями, а исходный объект остаётся неизменным.

---

### **Ключевые особенности имутабельности**

1. **Неизменность состояния**:
    
    - После создания объекта его внутренние данные остаются неизменными.
2. **Создание копий**:
    
    - Любое "изменение" данных приводит к созданию нового объекта.
3. **Потокобезопасность**:
    
    - Так как объекты не изменяются, они безопасны для использования в многопоточных системах без необходимости в синхронизации.

---

### **Пример имутабельности на PHP**

В PHP можно реализовать имутабельные объекты с помощью неизменяемых свойств:

```php
final class ImmutableUser
{
    private string $name;
    private int $age;

    public function __construct(string $name, int $age)
    {
        $this->name = $name;
        $this->age = $age;
    }

    public function withName(string $newName): self
    {
        return new self($newName, $this->age);
    }

    public function withAge(int $newAge): self
    {
        return new self($this->name, $newAge);
    }

    public function getName(): string
    {
        return $this->name;
    }

    public function getAge(): int
    {
        return $this->age;
    }
}

// Использование:
$user = new ImmutableUser('John', 30);
$newUser = $user->withAge(31);

echo $user->getAge();    // 30
echo $newUser->getAge(); // 31
```

---

### **Преимущества имутабельности**

1. **Простота отладки**:
    
    - Неизменяемые объекты упрощают отслеживание состояния, так как оно не меняется в процессе выполнения программы.
2. **Потокобезопасность**:
    
    - Имутабельные объекты можно безопасно использовать в многопоточных системах без блокировок.
3. **Упрощённая логика**:
    
    - Нет необходимости следить за изменениями объекта или заботиться о побочных эффектах.
4. **Поддержка функционального программирования**:
    
    - Имутабельность — основа для построения чистых функций.
5. **Лёгкость тестирования**:
    
    - Имутабельные объекты легче тестировать, так как их состояние предсказуемо.

---

### **Недостатки имутабельности**

1. **Повышенное использование памяти**:
    
    - Каждый раз, когда объект "изменяется", создаётся новый экземпляр, что увеличивает затраты памяти.
2. **Сложность в некоторых задачах**:
    
    - Для работы с большими объёмами данных или объектами, которые часто меняются, использование имутабельности может быть неэффективным.
3. **Повышенная сложность кода**:
    
    - Для реализации даже простых изменений требуются дополнительные методы.

---

### **Имутабельность и PHP**

PHP не поддерживает полную "чистую" имутабельность на уровне языка, но позволяет её эмулировать:

1. **Использование `readonly` свойств** (доступно с PHP 8.1):
    
    - Свойства, объявленные как `readonly`, могут быть установлены только один раз в конструкторе и не изменяются позже.
    
    ```php
    class User
    {
        public readonly string $name;
    
        public function __construct(string $name)
        {
            $this->name = $name;
        }
    }
    
    $user = new User('Alice');
    // $user->name = 'Bob'; // Ошибка: readonly свойство нельзя изменить
    ```
    
2. **Финализированные классы и свойства**:
    
    - `final` классы и свойства предотвращают переопределение логики, делая код более предсказуемым.

---

### **Примеры использования имутабельности**

1. **Дата и время**:
    
    - Класс `DateTimeImmutable` в PHP — яркий пример реализации имутабельности.
        
    - Пример:
        
        ```php
        $date = new DateTimeImmutable('2024-01-01');
        $newDate = $date->modify('+1 day');
        
        echo $date->format('Y-m-d');    // 2024-01-01
        echo $newDate->format('Y-m-d'); // 2024-01-02
        ```
        
2. **DTO (Data Transfer Object)**:
    
    - Использование DTO для передачи неизменяемых данных между слоями приложения.
3. **Функциональное программирование**:
    
    - В функциональном стиле программы предпочитаются неизменяемые данные для минимизации побочных эффектов.

---

### **Имутабельность в других языках**

1. **Java**:
    
    - Класс `String` в Java неизменяемый.
    - `Immutable Collections` из Java 9+.
2. **JavaScript**:
    
    - Использование библиотеки `Immutable.js` или встроенного метода `Object.freeze()` для создания неизменяемых объектов.
3. **Python**:
    
    - Тип `tuple` неизменяем, в отличие от изменяемого `list`.

---

### **Где применять имутабельность**

1. **Конкурентные приложения**:
    
    - Потокобезопасность обеспечивает надёжность системы.
2. **Кэширование данных**:
    
    - Удобно для создания кэшированных копий неизменяемых объектов.
3. **Сложные системы**:
    
    - Системы, где требуется отслеживать версии или изменения данных (например, Event Sourcing).
4. **Тестирование и отладка**:
    
    - Имутабельность упрощает воспроизведение ошибок, так как состояние объектов не меняется.

---

### **Заключение**

Имутабельность — это мощный подход к управлению состоянием объектов, который помогает сделать системы более надёжными, предсказуемыми и безопасными. Однако, её применение требует баланса между удобством разработки, производительностью и потреблением ресурсов.